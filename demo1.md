# demo1

可行性验证程度的demo

基于君浪即将发布的h5mota3.0的回合制塔

按照怪要砍5回合左右设计

复杂ui先借助dom糊出来

## 回合内机制  

先只分三个阶段  
玩家行动-怪物行动-结束阶段  
`player-enemy-end`  
要能够较方便的在各阶段注册事件  
每三个回合的回复以及怪物的额外行动  

## 简化的领悟系统  

只有3个已经点了个领悟  
- 伤害法术系  
  单体  
  范围 解锁:单体击杀10  
  施法后能移动 :范围击杀10  
- 伤害技能系  
  单体  
  范围 :单体击杀10   
  强化的普攻 :范围击杀10  
- 辅助系  
  加格挡  
  盾击技能 :格挡20次  
  blink法术 :击杀10个眩晕的人  

## 神的系统  

三个神  

- 加喜好
  + 回血
  + 普攻

  减喜好
  + 技能

  普攻加成/回血法术

- 加喜好
  + 技能

  减喜好
  + 法术
  + 回蓝

  伤害技能/技能加成

- 加喜好
  + 法术
  + 耗蓝

  减喜好
  + 普攻
  + 耗血

  蓝上限/回蓝速度

## 伤害机制

来源: 法术/技能/普攻  

类型: 打击/火焰  

有格挡无闪避

## 地图

26*26, 无陷阱, 50个怪左右

---

# 实现部分

**把图片/音乐/动画拆出为另一个项目**

修改server.py, 使得处理project时读写另一个子项目下的文件, 也可以做到一些类似字符串模板的事情, 把特定的内容用别的文件替代

以下通过插件来做

**约定一些函数**

utilFunctions

(命名待更改)

core.lockmove  
core.unlockmove  
core.islockmove  
锁定地图区域, 无法移动/使用技能物品快捷键

core.lockuipanel  
core.unlockuipanel  
core.islockuipanel  
锁定读取存档等按钮



**回合内机制**

TurnBased

约定对象格式, 带回合数以及一些数值的约定

类 TurnEvent

如何注册和释放  
core.registerTurnEvent('player',TurnEvent1)  
core.removeTurnEvent('player',TurnEvent1)  
阶段是否要作为TurnEvent属性不放在注册时的参数

blink在回合机制的体现(除了选位置扣蓝之外的):  
标记一个mark (mark存在则玩家无法行动)  
在end阶段推一个事件, 该事件计数是2, 也就是两回合的结束阶段触发  
事件触发时 1.移除mark 2.把玩家位置转移到设定的目标 3.把结束阶段内的本事件移除

激活的怪物:  
把对应自身的事件加入到enemy阶段, 无计数, 触发效果是选择移动或攻击等  
死亡时也把事件移除  

每次玩家可行动时, 由于存在"回合内多次行动/施法后可移动/击杀后仍可行动"等可能, 系统实际上处于以下状态之一, 当以下状态均不成立时, 玩家行动的阶段结束
+ 最一般的状态, 玩家可以自由行动
+ 等待移动(选择原地不动也是移动的一种)
+ 等待施法或技能
+ 玩家已经点击了施法等, 此时在选择目标, 只能点屏幕无法移动

(此处类只代表对象格式的约定, 要使得json化后复原与源对象一致, -\>不能使用引用, 只能存整数下标来引用)

**怪物和玩家相同的属性**

CharacterClass

+ 血/血上限/血回复速度
+ 蓝/蓝上限/蓝回复速度
+ 普攻的各伤害的数值
+ 技能强度
+ 法术强度
+ 各伤害的抵抗
+ 当前累计的剧毒值
+ 格挡条/格挡条满值/格挡率/格挡值
+ 每回合的行动点数

此版本中尚无buff/debuff

形如data中的英雄, 包装成类Character

```js
"hero": {
    "name": "阳光",
    "hpmax": 9999,
    "hp": 100,
    "manamax": -1,
    "mana": 10,
    "atk": 10,
    "def": 10,
    "mdef": 0,
    "money": 0,
    "experience": 0,
    "loc": {
        "direction": "up",
        "x": 6,
        "y": 10
    },
}
```

**部分ui**

查看一个激活的怪物的所有数值

技能选择目标

**录像支持**

准备搞一套可能会比较像 临时物品 的机制, 要比较自然的支持一个字符串脚本进录像

保证录像或游戏进行到该阶段时, 一个 临时物品 被脚本创建了, 玩家的选择变为使用物品触发和进入录像